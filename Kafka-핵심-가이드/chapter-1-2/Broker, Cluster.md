
## Broker

프로듀서와 컨슈머 사이에서 중개자 역할을 하는 서버를 브로커라고 부른다.
하나의 카프카 서버 자체를 브로커라고 부른다. 

- 프로듀서로부터 메세지를 전달받아 offset을 할당한 뒤 disk 저장소에 쓴다.
- 컨슈머의 파티션 읽기 (fetch) 요청을 처리하고 발행된 메세지를 보내준다.
- 하나의 브로커는 초당 수천 개의 파티션과 수백만 개의 메세지를 쉽게 처리할 수 있다.
- 브로커는 토픽에 대해 기본적인 보존 설정이 되어 있다.
	- 특정 기간동안 메세지를 보존하거나 파티션의 크기가 특정 사이즈에 도달할 때까지 데이터를 보존한다. 한계치에 도달하면 메세지는 만료되어 삭제된다.
	- 이것은 카프카의 핵심 기능중 하나이다.

## Cluster

- 하나의 클러스터 안에 여러 개의 브로커가 포함될 수 있다.
- 여러 개의 브로커중 하나의 브로커가 클러스터 컨트롤러의 역할을 하게 된다.
	- 컨트롤러는 클러스터 안의 현재 작동중인 브로커중 하나가 자동으로 선정된다.
	- 컨트롤러는 파티션을 브로커에게 할당해주거나 장애가 발생한 브로커를 모니터링 하는 등의 관리 기능을 담당한다.
- 파티션은 클러스터 안의 브로커 중 하나가 담당하고, 그 브로커를 파티션 리더라고 부른다. (partition leader)
- 복제된 파티션이 여러 브로커에 할당될 수도 있는데 그것을 파티션의 팔로워라고 부른다. (partition follower) 
- 복제 기능은 파티션의 메세지를 중복 저장함으로써 리더 브로커에 장애가 발생했을 때 팔로워중 하나가 리더 역할을 이어받을 수 있도록 한다.
- 모든 프로듀서는 리더 브로커에 메세지를 발행해야 한다.
- 컨슈머는 leader, follwer 중 하나로부터 데이터를 읽어 올 수 있다.
![[카프카클러스터.png]]